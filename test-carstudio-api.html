<!DOCTYPE html>
<html>
<head>
    <title>CarStudio API Test</title>
</head>
<body>
    <h1>CarStudio API Direct Test</h1>
    <button onclick="testDirect()">Test Direct API</button>
    <button onclick="testViaProxy()">Test Via Proxy</button>
    <pre id="result"></pre>

    <script>
        const API_KEY = 'e3c31fe81d1345b9a91996043d452d91';
        const PROXY_URL = 'https://jjepfehmuybpctdzipnu.supabase.co/functions/v1/carstudio-proxy';

        async function testDirect() {
            document.getElementById('result').textContent = 'Testing direct API call...';

            const formData = new FormData();
            formData.append('images[0].fileUrl', 'https://placehold.co/600x400');
            formData.append('images[0].position', 'FRONT');

            try {
                const response = await fetch('https://tokyo.carstudio.ai/webEditor/uploadImagesWithUrlV2', {
                    method: 'POST',
                    headers: {
                        'apiKey': API_KEY
                    },
                    body: formData
                });

                const data = await response.json();
                document.getElementById('result').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('result').textContent = 'Error: ' + error.message;
            }
        }

        async function testViaProxy() {
            document.getElementById('result').textContent = 'Testing via proxy...';

            const formData = new FormData();
            formData.append('images[0].fileUrl', 'https://placehold.co/600x400');
            formData.append('images[0].position', 'FRONT');

            const targetUrl = 'https://tokyo.carstudio.ai/webEditor/uploadImagesWithUrlV2';
            const proxyUrl = `${PROXY_URL}?url=${encodeURIComponent(targetUrl)}`;

            console.log('Proxy URL:', proxyUrl);
            console.log('API Key:', API_KEY);

            try {
                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: {
                        'apiKey': API_KEY
                    },
                    body: formData
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                const data = await response.json();
                document.getElementById('result').textContent = 'Success!\n\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Fetch error:', error);
                document.getElementById('result').textContent = 'Error: ' + error.message + '\n\nCheck browser console (F12) for details';
            }
        }
    </script>
</body>
</html>
