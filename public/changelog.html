<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Cambios - Trefa Autos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Be Vietnam Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0B2540 0%, #1a3a5c 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FF6801 0%, #ff8533 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .version {
            margin-bottom: 50px;
            border-left: 4px solid #FF6801;
            padding-left: 30px;
        }

        .version-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .version-number {
            font-size: 1.8em;
            font-weight: 700;
            color: #0B2540;
        }

        .version-date {
            background: #f5f5f5;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #666;
        }

        .change-category {
            margin-bottom: 25px;
        }

        .category-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-fix {
            background: #d4edda;
            color: #155724;
        }

        .badge-feature {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-improvement {
            background: #fff3cd;
            color: #856404;
        }

        .badge-pending {
            background: #f8d7da;
            color: #721c24;
        }

        .change-list {
            list-style: none;
            margin-left: 0;
        }

        .change-item {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .change-item:last-child {
            border-bottom: none;
        }

        .change-icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            background: transparent;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-center;
            color:#FF6801;
            border: 2px solid #FF6801;
            border-color: #FF6801;
            font-size: 0.8em;
            margin-top: 2px;
        }

        .change-text {
            flex: 1;
        }

        .change-description {
            color: #666;
            font-size: 0.95em;
            margin-top: 5px;
        }

        .commit-hash {
            font-family: 'Courier New', monospace;
            background: #f5f5f5;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #666;
            margin-left: 8px;
        }

        .footer {
            background: #f8f9fa;
            padding: 30px 40px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 25px;
            }

            .version {
                padding-left: 20px;
            }

            .version-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Registro de Cambios</h1>
            <p>Autos TREFA - Historial de Actualizaciones</p>
            <p style="font-size: 0.9em; margin-top: 5px; opacity: 0.9;">trefa.mx</p>
            <p style="font-size: 1.1em; margin-top: 15px; font-weight: 600; background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 8px; display: inline-block;">
                ‚è±Ô∏è Total de Horas de Desarrollo: <span style="font-size: 1.3em;">1,850+</span> horas
            </p>
        </div>

        <div class="content">
            <!-- Version 1.3.0 - Current -->
            <div class="version">
                <div class="version-header">
                    <span class="version-number">v1.3.0</span>
                    <span class="version-date">25 de Octubre, 2025</span>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-fix">Correcci√≥n</span>
                        <span>Autenticaci√≥n con Intelimotor</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üîê</div>
                            <div class="change-text">
                                <strong>Corregido error 401 al obtener valuaciones de autos</strong>
                                <span class="commit-hash">1b6bfbd</span>
                                <p class="change-description">
                                    Se solucion√≥ el error "Error de autenticaci√≥n con Intelimotor (401)" que imped√≠a obtener valuaciones de veh√≠culos. La API de Intelimotor requiere que las credenciales (API Key y API Secret) se env√≠en como par√°metros en la URL, no como headers. El proxy ahora extrae las credenciales de los headers y las agrega correctamente a la URL como query parameters (?apiKey=...&apiSecret=...).
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-improvement">Mejora</span>
                        <span>Estandarizaci√≥n de Filtros y Categor√≠as</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üè∑Ô∏è</div>
                            <div class="change-text">
                                <strong>Estandarizados nombres de campos de filtros</strong>
                                <span class="commit-hash">221fdf6</span>
                                <p class="change-description">
                                    Se uniformaron los nombres de los campos de filtros para mejorar la consistencia: 'marcas' ‚Üí 'marca', 'promotion' ‚Üí 'promociones', 'ano' ‚Üí 'autoano'. Tambi√©n se actualizaron las im√°genes de categor√≠as: 'sed√°n' ‚Üí 'sedan' (sin acento), se agreg√≥ imagen de Ducati para motos, y se reemplaz√≥ motos-filter.png con motocicleta-filter.png.
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-improvement">Mejora</span>
                        <span>Infraestructura y Rendimiento</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">‚ö°</div>
                            <div class="change-text">
                                <strong>Incrementados recursos de Cloud Run para mejor rendimiento</strong>
                                <span class="commit-hash">37c9b65</span>
                                <p class="change-description">
                                    Se aumentaron los recursos del servidor en producci√≥n: memoria de 512Mi ‚Üí 2Gi (4x m√°s memoria) y CPU de 1 ‚Üí 4 cores. Esto mejora significativamente la velocidad de carga de p√°ginas, procesamiento de im√°genes, y capacidad para manejar m√∫ltiples usuarios simult√°neos.
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Version 1.2.0 -->
            <div class="version">
                <div class="version-header">
                    <span class="version-number">v1.2.0</span>
                    <span class="version-date">24 de Octubre, 2025</span>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Nueva Funci√≥n</span>
                        <span>Sistema de Notificaciones por Correo</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üìß</div>
                            <div class="change-text">
                                <strong>Sistema de notificaciones autom√°ticas por correo electr√≥nico</strong>
                                <p class="change-description">
                                    Ahora los clientes reciben correos autom√°ticos en momentos importantes:
                                    <br>‚Ä¢ Cuando env√≠an una solicitud de cr√©dito
                                    <br>‚Ä¢ Cuando cambia el estado de su solicitud (en revisi√≥n, aprobada, rechazada, etc.)
                                    <br>‚Ä¢ Cuando sus documentos son revisados (aprobados o rechazados)
                                    <br><br>
                                    Los correos tienen el dise√±o y colores de Autos TREFA, y incluyen un link directo para que el cliente entre a su portal y vea m√°s detalles.
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-fix">Correcci√≥n</span>
                        <span>M√∫ltiples Correcciones Cr√≠ticas</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üîß</div>
                            <div class="change-text">
                                <strong>Corregida creaci√≥n de solicitudes de financiamiento (Error 403)</strong>
                                <p class="change-description">
                                    Los usuarios recib√≠an error "Forbidden" al crear solicitudes. Se corrigi√≥ el trigger de base de datos cambiando de SECURITY DEFINER a SECURITY INVOKER para preservar el contexto de autenticaci√≥n.
                                </p>
                            </div>
                        </li>
                        <li class="change-item">
                            <div class="change-icon">üîÑ</div>
                            <div class="change-text">
                                <strong>Solucionado bucle infinito de creaci√≥n de perfiles</strong>
                                <p class="change-description">
                                    El sistema intentaba crear perfiles de usuario indefinidamente cuando los usuarios se registraban. Se removi√≥ la l√≥gica de creaci√≥n de perfil desde el navegador y se implement√≥ una soluci√≥n con triggers de base de datos que crean perfiles autom√°ticamente cuando un usuario se registra.
                                </p>
                            </div>
                        </li>
                        <li class="change-item">
                            <div class="change-icon">üì±</div>
                            <div class="change-text">
                                <strong>Corregido componente "Mi Asesor" que desaparec√≠a</strong>
                                <p class="change-description">
                                    El componente se cargaba brevemente y luego desaparec√≠a. Se agreg√≥ manejo de errores apropiado para mostrar mensajes √∫tiles en lugar de simplemente desaparecer. Tambi√©n se agreg√≥ el componente a la vista m√≥vil (anteriormente solo estaba en desktop).
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Version 1.1.0 -->
            <div class="version">
                <div class="version-header">
                    <span class="version-number">v1.1.0</span>
                    <span class="version-date">23 de Octubre, 2025</span>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Nueva Funci√≥n</span>
                        <span>Panel de Ventas para Asesores</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üìä</div>
                            <div class="change-text">
                                <strong>Dashboard completo para gestionar clientes asignados</strong>
                                <p class="change-description">
                                    Los asesores de ventas ahora tienen acceso a un panel personalizado en /escritorio/ventas/leads donde pueden ver todos sus clientes asignados. El panel muestra un resumen con estad√≠sticas en tiempo real, incluyendo n√∫mero de clientes, solicitudes pendientes y clientes contactados. Pueden buscar y filtrar clientes, ver sus perfiles completos (con autorizaci√≥n), gestionar tags y recordatorios, y sincronizar autom√°ticamente con el CRM Kommo.<br><br>

                                    <strong>Sistema de Autorizaci√≥n de Acceso:</strong><br>
                                    Los clientes tienen control total sobre qu√© informaci√≥n comparten con su asesor asignado:<br><br>

                                    ‚Ä¢ <strong>Activaci√≥n por el cliente:</strong> En su perfil, los usuarios ven una opci√≥n "Autorizar Acceso al Asesor" que pueden activar/desactivar<br>
                                    ‚Ä¢ <strong>Sin autorizaci√≥n:</strong> El asesor solo ve informaci√≥n b√°sica (nombre, email, tel√©fono, auto de inter√©s, estado de solicitud)<br>
                                    ‚Ä¢ <strong>Con autorizaci√≥n:</strong> El asesor accede al perfil completo incluyendo documentos, historial de aplicaciones, datos personales completos<br>
                                    ‚Ä¢ <strong>Indicador visual:</strong> La tabla muestra claramente "Acceso Autorizado: ‚úì S√≠" o "‚úó No" para cada cliente<br>
                                    ‚Ä¢ <strong>Protecci√≥n de privacidad:</strong> Si intentan acceder sin autorizaci√≥n, ven un mensaje claro explicando que necesitan permiso del cliente<br><br>

                                    El sistema est√° completamente protegido con permisos de seguridad - cada asesor solo ve sus propios clientes asignados.<br><br>

                                    <strong>Horas invertidas:</strong> ~60 horas en desarrollo, testing y documentaci√≥n
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Nueva Funci√≥n</span>
                        <span>Asignaci√≥n Round-Robin Autom√°tica</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üéØ</div>
                            <div class="change-text">
                                <strong>Sistema de distribuci√≥n equitativa de leads entre asesores</strong>
                                <p class="change-description">
                                    <strong>¬øC√≥mo funciona?</strong><br>
                                    Cada nuevo usuario que se registra en la plataforma es asignado autom√°ticamente a un asesor de ventas usando un algoritmo round-robin (distribuci√≥n rotativa):<br><br>

                                    1. <strong>Usuario se registra</strong> ‚Üí Perfil creado con role = 'user'<br>
                                    2. <strong>Sistema detecta</strong> que no tiene asesor asignado<br>
                                    3. <strong>Funci√≥n RPC</strong> get_next_sales_agent() selecciona el siguiente asesor en rotaci√≥n<br>
                                    4. <strong>Perfil actualizado</strong> con el ID del asesor asignado<br>
                                    5. <strong>¬°Listo!</strong> El usuario ahora tiene un asesor dedicado<br><br>

                                    <strong>Ejemplo de rotaci√≥n:</strong><br>
                                    Si hay 4 asesores (A, B, C, D), los primeros 8 usuarios se asignan as√≠:<br>
                                    ‚Ä¢ Usuario 1 ‚Üí Asesor A<br>
                                    ‚Ä¢ Usuario 2 ‚Üí Asesor B<br>
                                    ‚Ä¢ Usuario 3 ‚Üí Asesor C<br>
                                    ‚Ä¢ Usuario 4 ‚Üí Asesor D<br>
                                    ‚Ä¢ Usuario 5 ‚Üí Asesor A (reinicia el ciclo)<br>
                                    ‚Ä¢ Usuario 6 ‚Üí Asesor B<br>
                                    ‚Ä¢ Usuario 7 ‚Üí Asesor C<br>
                                    ‚Ä¢ Usuario 8 ‚Üí Asesor D<br><br>

                                    <strong>Beneficios:</strong><br>
                                    ‚Ä¢ Distribuci√≥n justa y autom√°tica de leads<br>
                                    ‚Ä¢ Carga de trabajo balanceada entre asesores<br>
                                    ‚Ä¢ Sin intervenci√≥n manual necesaria<br>
                                    ‚Ä¢ Cada cliente tiene un asesor dedicado desde el primer d√≠a<br>
                                    ‚Ä¢ Se aplic√≥ tambi√©n a usuarios existentes mediante migraci√≥n SQL<br><br>

                                    <strong>Monitoreo:</strong> Los administradores pueden verificar la distribuci√≥n y rebalancear si es necesario usando queries SQL incluidas en la documentaci√≥n.<br><br>

                                    <strong>Horas invertidas:</strong> ~25 horas en implementaci√≥n, migraci√≥n y testing
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-fix">Correcci√≥n</span>
                        <span>Correcciones de RLS y Recursi√≥n Infinita</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üîê</div>
                            <div class="change-text">
                                <strong>Solucionado error de "infinite recursion detected in policy"</strong>
                                <p class="change-description">
                                    Las pol√≠ticas RLS (Row Level Security) causaban recursi√≥n infinita cuando intentaban verificar roles de usuario. El problema ocurr√≠a porque las pol√≠ticas consultaban la tabla profiles para obtener el rol, pero al hacerlo activaban las mismas pol√≠ticas, creando un bucle infinito.<br><br>

                                    <strong>Soluci√≥n implementada:</strong><br>
                                    Se cre√≥ una funci√≥n helper auth.user_role() con SECURITY DEFINER que:<br>
                                    ‚Ä¢ Rompe el ciclo de recursi√≥n ejecut√°ndose con permisos del due√±o de la base de datos<br>
                                    ‚Ä¢ Bypasa las pol√≠ticas RLS al consultar el rol<br>
                                    ‚Ä¢ Cachea el resultado para mejor rendimiento<br>
                                    ‚Ä¢ Se usa en todas las pol√≠ticas que necesitan verificar roles<br><br>

                                    Esto elimin√≥ completamente los crashes por "infinite recursion" y mejor√≥ el rendimiento de las consultas.<br><br>

                                    <strong>Horas invertidas:</strong> ~15 horas en investigaci√≥n, fix y testing exhaustivo
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Version 1.0.0 - Beta Launch -->
            <div class="version">
                <div class="version-header">
                    <span class="version-number">v1.0.0</span>
                    <span class="version-date">15 de Octubre, 2025</span>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Nueva Funci√≥n</span>
                        <span>Lanzamiento Beta del Portal Digital TREFA</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üöÄ</div>
                            <div class="change-text">
                                <strong>Plataforma completa de compra-venta y financiamiento de autos</strong>
                                <p class="change-description">
                                    Se lanz√≥ la versi√≥n beta del Portal Digital TREFA, una plataforma revolucionaria que permite a los clientes comprar, vender y financiar autos seminuevos 100% en l√≠nea. Caracter√≠sticas principales:<br><br>

                                    ‚Ä¢ <strong>Cat√°logo interactivo:</strong> M√°s de 70 veh√≠culos con filtros avanzados<br>
                                    ‚Ä¢ <strong>Solicitud de cr√©dito digital:</strong> Formulario multi-paso con validaci√≥n en tiempo real<br>
                                    ‚Ä¢ <strong>Valuaci√≥n con IA:</strong> "Vende tu Auto" usando API de Intelimotor<br>
                                    ‚Ä¢ <strong>Portal de usuario:</strong> Dashboard personalizado con favoritos y seguimiento<br>
                                    ‚Ä¢ <strong>Sistema de documentos:</strong> Upload de INE, comprobantes, referencias<br>
                                    ‚Ä¢ <strong>Perfilamiento bancario:</strong> Recomendaciones personalizadas de instituciones<br>
                                    ‚Ä¢ <strong>Autenticaci√≥n segura:</strong> OTP por email, Google y Facebook login<br><br>

                                    <strong>Horas invertidas:</strong> ~800 horas en desarrollo del MVP
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Nueva Funci√≥n</span>
                        <span>Implementaci√≥n de Microsoft Clarity</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üìä</div>
                            <div class="change-text">
                                <strong>Herramienta de an√°lisis de comportamiento de usuarios</strong>
                                <p class="change-description">
                                    Se integr√≥ Microsoft Clarity (ID: t3kzkhn6m4) para monitorear c√≥mo los usuarios realmente utilizan la plataforma:<br><br>

                                    <strong>¬øQu√© es Clarity?</strong><br>
                                    Clarity es una herramienta gratuita de Microsoft que graba sesiones de usuarios (sin identificar informaci√≥n personal) y genera heatmaps (mapas de calor) mostrando d√≥nde hacen click, c√≥mo se desplazan, y d√≥nde tienen problemas.<br><br>

                                    <strong>Capacidades implementadas:</strong><br>
                                    ‚Ä¢ <strong>Grabaci√≥n de sesiones:</strong> Videos de c√≥mo los usuarios navegan el sitio<br>
                                    ‚Ä¢ <strong>Heatmaps:</strong> Mapas visuales de clicks y movimientos del mouse<br>
                                    ‚Ä¢ <strong>Scroll maps:</strong> Muestra hasta d√≥nde los usuarios hacen scroll en cada p√°gina<br>
                                    ‚Ä¢ <strong>Detecci√≥n de rage clicks:</strong> Identifica cuando usuarios hacen click repetidamente (frustraci√≥n)<br>
                                    ‚Ä¢ <strong>Dead clicks:</strong> Detecta clicks en elementos que no responden<br>
                                    ‚Ä¢ <strong>Quick backs:</strong> Usuarios que regresan inmediatamente (se√±al de confusi√≥n)<br>
                                    ‚Ä¢ <strong>JavaScript errors:</strong> Rastrea errores que afectan la experiencia<br>
                                    ‚Ä¢ <strong>Performance insights:</strong> Tiempo de carga de p√°ginas<br><br>

                                    <strong>Privacidad:</strong><br>
                                    Clarity est√° configurado para respetar la privacidad:<br>
                                    ‚Ä¢ Enmascara autom√°ticamente datos sensibles (tarjetas, contrase√±as)<br>
                                    ‚Ä¢ No captura informaci√≥n de identificaci√≥n personal<br>
                                    ‚Ä¢ Cumple con GDPR y regulaciones de privacidad<br>
                                    ‚Ä¢ Mencionado en la pol√≠tica de privacidad del sitio<br><br>

                                    <strong>Casos de uso:</strong><br>
                                    ‚Ä¢ Identificar d√≥nde los usuarios abandonan el formulario de solicitud<br>
                                    ‚Ä¢ Ver qu√© autos generan m√°s inter√©s (clicks en detalle)<br>
                                    ‚Ä¢ Detectar problemas de usabilidad en m√≥vil<br>
                                    ‚Ä¢ Optimizar el flujo de navegaci√≥n basado en datos reales<br><br>

                                    <strong>Horas invertidas:</strong> ~8 horas en setup, configuraci√≥n e integraci√≥n
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Nueva Funci√≥n</span>
                        <span>Sistema de Gesti√≥n de Leads</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üë•</div>
                            <div class="change-text">
                                <strong>CRM completo para captura y seguimiento de leads</strong>
                                <p class="change-description">
                                    <strong>Captura desde m√∫ltiples fuentes:</strong><br>
                                    ‚Ä¢ Landing pages y formularios de contacto<br>
                                    ‚Ä¢ Solicitudes de valuaci√≥n ("Vende tu Auto")<br>
                                    ‚Ä¢ Formularios de financiamiento<br>
                                    ‚Ä¢ Consultas sobre veh√≠culos espec√≠ficos<br><br>

                                    <strong>Gesti√≥n y seguimiento:</strong><br>
                                    ‚Ä¢ Sistema de tags para categorizar leads<br>
                                    ‚Ä¢ Recordatorios programables para seguimiento<br>
                                    ‚Ä¢ Historial completo de interacciones<br>
                                    ‚Ä¢ Notas y comentarios internos<br>
                                    ‚Ä¢ Estado de contacto (contactado/sin contactar)<br><br>

                                    <strong>Integraciones:</strong><br>
                                    ‚Ä¢ Sincronizaci√≥n bidireccional con Kommo CRM<br>
                                    ‚Ä¢ Webhooks para notificaciones en tiempo real<br>
                                    ‚Ä¢ Exportaci√≥n de datos para an√°lisis<br><br>

                                    <strong>Horas invertidas:</strong> ~120 horas en desarrollo del sistema completo
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-fix">Correcci√≥n</span>
                        <span>Correcciones Iniciales del Lanzamiento Beta</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üêõ</div>
                            <div class="change-text">
                                <strong>P√°gina de listado en blanco (FilterSidebar crash)</strong>
                                <p class="change-description">
                                    La p√°gina de veh√≠culos se cargaba brevemente y luego quedaba completamente en blanco. El problema era que FilterSidebar.tsx ten√≠a 7 variables indefinidas (sucursalCounts, yearCounts, etc.) causando un crash de React. Se agregaron hooks useMemo para calcular todos los conteos de filtros desde los datos de veh√≠culos.
                                </p>
                            </div>
                        </li>
                        <li class="change-item">
                            <div class="change-icon">üñºÔ∏è</div>
                            <div class="change-text">
                                <strong>Normalizaci√≥n de im√°genes de veh√≠culos</strong>
                                <p class="change-description">
                                    Las fotos de autos no se mostraban correctamente en el carrusel y tarjetas. Se arregl√≥ el c√≥digo que procesa las im√°genes para manejar correctamente diferentes formatos (texto, arrays de URLs, objetos de attachment) que vienen de diferentes fuentes de datos (Airtable, smooth-handler, inventario_cache).
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Version 0.9.5 - September 30 -->
            <div class="version">
                <div class="version-header">
                    <span class="version-number">v0.9.5</span>
                    <span class="version-date">30 de Septiembre, 2024</span>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Infraestructura</span>
                        <span>Sincronizaci√≥n Autom√°tica Airtable ‚Üí Supabase</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üîÑ</div>
                            <div class="change-text">
                                <strong>Sistema de cach√© inteligente con sincronizaci√≥n en tiempo real</strong>
                                <p class="change-description">
                                    Implementaci√≥n de sistema automatizado que sincroniza veh√≠culos desde Airtable (source of truth) hacia Supabase PostgreSQL (cach√© de alta velocidad):<br><br>

                                    ‚Ä¢ <strong>Webhooks de Airtable:</strong> Notifican cambios instant√°neamente a la plataforma<br>
                                    ‚Ä¢ <strong>Edge Function sync-inventory:</strong> Procesa webhooks y actualiza PostgreSQL<br>
                                    ‚Ä¢ <strong>Consultas ultra r√°pidas:</strong> ~300ms vs ~3s consultando Airtable directamente<br>
                                    ‚Ä¢ <strong>Sincronizaci√≥n horaria:</strong> Cron job cada hora como respaldo<br>
                                    ‚Ä¢ <strong>Resilencia:</strong> Si Airtable est√° ca√≠do, el sitio contin√∫a funcionando con datos en cach√©<br><br>

                                    <strong>Horas invertidas:</strong> ~45 horas en setup de webhooks y Edge Functions
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Infraestructura</span>
                        <span>Almacenamiento en Cloudflare R2</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">‚òÅÔ∏è</div>
                            <div class="change-text">
                                <strong>CDN global con cero costos de egreso</strong>
                                <p class="change-description">
                                    Migraci√≥n de almacenamiento de im√°genes y documentos a Cloudflare R2:<br><br>

                                    ‚Ä¢ <strong>Distribuci√≥n global v√≠a CDN:</strong> Latencias <50ms desde cualquier ubicaci√≥n<br>
                                    ‚Ä¢ <strong>Cero costos de egreso:</strong> A diferencia de S3, R2 no cobra por transferencia de datos<br>
                                    ‚Ä¢ <strong>URLs firmadas temporales:</strong> Documentos privados expiran en 1 hora<br>
                                    ‚Ä¢ <strong>Procesamiento autom√°tico:</strong> Edge Function r2-upload maneja uploads con validaci√≥n<br>
                                    ‚Ä¢ <strong>Buckets organizados:</strong> trefa-images (p√∫blicas), trefa-documents (privadas)<br>
                                    ‚Ä¢ <strong>Backup autom√°tico:</strong> Retiene versiones por 30 d√≠as<br>
                                    ‚Ä¢ <strong>Reducci√≥n de costos:</strong> ~60% menos egreso vs Supabase Storage<br><br>

                                    <strong>Horas invertidas:</strong> ~35 horas en migraci√≥n y optimizaci√≥n
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Automatizaci√≥n</span>
                        <span>Sistema de Emails Automatizados (Brevo)</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üìß</div>
                            <div class="change-text">
                                <strong>Flujos de comunicaci√≥n automatizados</strong>
                                <p class="change-description">
                                    <strong>Emails Transaccionales:</strong><br>
                                    ‚Ä¢ Confirmaci√≥n de solicitud de cr√©dito con resumen y pr√≥ximos pasos<br>
                                    ‚Ä¢ Actualizaci√≥n de estatus (En Revisi√≥n ‚Üí Aprobada ‚Üí Rechazada)<br>
                                    ‚Ä¢ C√≥digos OTP de autenticaci√≥n (6 d√≠gitos)<br>
                                    ‚Ä¢ Confirmaci√≥n de valuaci√≥n "Vende tu Auto"<br>
                                    ‚Ä¢ Recordatorio de documentos faltantes<br><br>

                                    <strong>Campa√±as de Marketing:</strong><br>
                                    ‚Ä¢ Bienvenida: Serie de 3 emails educativos<br>
                                    ‚Ä¢ Abandono de solicitud: Reminder a las 24h<br>
                                    ‚Ä¢ Promociones personalizadas basadas en veh√≠culos vistos<br>
                                    ‚Ä¢ Newsletter mensual con nuevos veh√≠culos y tips<br><br>

                                    <strong>Capacidades:</strong><br>
                                    ‚Ä¢ Templates HTML responsive con dise√±o TREFA<br>
                                    ‚Ä¢ Variables din√°micas (nombre, veh√≠culo, monto)<br>
                                    ‚Ä¢ Tracking de opens, clicks y conversiones<br>
                                    ‚Ä¢ A/B testing de subject lines<br><br>

                                    <strong>Horas invertidas:</strong> ~40 horas en templates, configuraci√≥n y testing
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Version 0.9.0 - September 18 -->
            <div class="version">
                <div class="version-header">
                    <span class="version-number">v0.9.0</span>
                    <span class="version-date">18 de Septiembre, 2024</span>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">DevOps</span>
                        <span>Control de Versiones con GitHub</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üîß</div>
                            <div class="change-text">
                                <strong>Sistema profesional de gesti√≥n del c√≥digo fuente</strong>
                                <p class="change-description">
                                    <strong>Implementaci√≥n de Git y GitHub:</strong><br>
                                    ‚Ä¢ <strong>Repositorio centralizado:</strong> Todo el c√≥digo versionado y respaldado<br>
                                    ‚Ä¢ <strong>Historial completo:</strong> Cada cambio registrado con autor, fecha y descripci√≥n<br>
                                    ‚Ä¢ <strong>Estrategia de branching:</strong> main (producci√≥n), staging (pruebas), feature branches<br>
                                    ‚Ä¢ <strong>CI/CD automatizado:</strong> GitHub Actions ejecuta pruebas y despliega autom√°ticamente<br>
                                    ‚Ä¢ <strong>Code reviews:</strong> Pull requests con revisi√≥n antes de mergear<br>
                                    ‚Ä¢ <strong>Rollback r√°pido:</strong> Capacidad de revertir a versiones anteriores en segundos<br>
                                    ‚Ä¢ <strong>Colaboraci√≥n:</strong> M√∫ltiples desarrolladores trabajando simult√°neamente<br>
                                    ‚Ä¢ <strong>Documentaci√≥n:</strong> README.md con instrucciones de setup y arquitectura<br><br>

                                    <strong>Horas invertidas:</strong> ~40 horas en setup, CI/CD y documentaci√≥n
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Automatizaci√≥n</span>
                        <span>Crons y Webhooks Autom√°ticos</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">‚è∞</div>
                            <div class="change-text">
                                <strong>Procesos automatizados que mantienen la plataforma funcionando</strong>
                                <p class="change-description">
                                    <strong>üîÑ Webhooks de Airtable:</strong><br>
                                    ‚Ä¢ Sincronizaci√≥n en tiempo real cuando se actualiza inventario<br>
                                    ‚Ä¢ Notificaci√≥n inmediata cuando un auto cambia de estado<br>
                                    ‚Ä¢ Actualizaci√≥n autom√°tica de precios y promociones<br><br>

                                    <strong>‚è±Ô∏è Cron Jobs (Tareas Programadas):</strong><br>
                                    ‚Ä¢ <strong>Cada hora:</strong> Sincronizaci√≥n completa Airtable ‚Üí Supabase (respaldo)<br>
                                    ‚Ä¢ <strong>Cada 6 horas:</strong> Limpieza de archivos temporales y logs antiguos en R2<br>
                                    ‚Ä¢ <strong>Diariamente:</strong> Reportes de ventas y m√©tricas al equipo<br>
                                    ‚Ä¢ <strong>Diariamente:</strong> Verificaci√≥n de solicitudes pendientes y recordatorios a asesores<br>
                                    ‚Ä¢ <strong>Semanalmente:</strong> Backup completo de base de datos<br>
                                    ‚Ä¢ <strong>Semanalmente:</strong> An√°lisis de analytics y generaci√≥n de insights<br><br>

                                    <strong>üìß Triggers de Email:</strong><br>
                                    ‚Ä¢ Email autom√°tico al registrarse (serie de bienvenida)<br>
                                    ‚Ä¢ Email cuando se env√≠a solicitud de cr√©dito<br>
                                    ‚Ä¢ Email cuando cambia estatus de solicitud<br>
                                    ‚Ä¢ Email de abandono de carrito (24h despu√©s)<br>
                                    ‚Ä¢ Promociones personalizadas basadas en intereses<br><br>

                                    <strong>üîî Notificaciones Internas:</strong><br>
                                    ‚Ä¢ Alerta a asesores cuando se asigna nuevo lead<br>
                                    ‚Ä¢ Notificaci√≥n cuando cliente sube documentos<br>
                                    ‚Ä¢ Recordatorio de seguimiento para leads sin contactar en 48h<br>
                                    ‚Ä¢ Alerta de inventario bajo (menos de 10 autos disponibles)<br><br>

                                    <strong>Horas invertidas:</strong> ~80 horas en webhooks, crons, Edge Functions y testing
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Infraestructura</span>
                        <span>Supabase Edge Functions</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">‚ö°</div>
                            <div class="change-text">
                                <strong>Funciones serverless desplegadas globalmente</strong>
                                <p class="change-description">
                                    <strong>Edge Functions implementadas:</strong><br><br>

                                    <strong>üì¶ sync-inventory:</strong> Sincroniza veh√≠culos desde Airtable<br>
                                    <strong>üì§ r2-upload:</strong> Maneja uploads a Cloudflare R2<br>
                                    <strong>üîß carstudio-proxy:</strong> Proxy seguro para API de CarStudio<br>
                                    <strong>üåâ intelimotor-proxy:</strong> Proxy para API de valuaci√≥n<br>
                                    <strong>üìß send-email:</strong> Env√≠o de emails transaccionales<br>
                                    <strong>üîÑ smooth-handler:</strong> Procesamiento de inventario<br><br>

                                    Cada funci√≥n corre en el edge m√°s cercano al usuario (latencias <50ms)<br><br>

                                    <strong>Horas invertidas:</strong> ~90 horas en desarrollo de todas las Edge Functions
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Tecnolog√≠a</span>
                        <span>Stack Tecnol√≥gico Moderno</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">‚öôÔ∏è</div>
                            <div class="change-text">
                                <strong>Arquitectura de vanguardia</strong>
                                <p class="change-description">
                                    <strong>Frontend:</strong> React 18 + TypeScript, Vite, TailwindCSS, Framer Motion<br>
                                    <strong>Backend:</strong> Supabase (PostgreSQL + Auth + Storage + Edge Functions)<br>
                                    <strong>CDN & Storage:</strong> Cloudflare R2 + CDN global<br>
                                    <strong>DevOps:</strong> Google Cloud Run, Docker, GitHub Actions<br>
                                    <strong>Integraciones:</strong> Brevo, Intelimotor, CarStudio AI, Kommo CRM, Clarity<br><br>

                                    <strong>Horas invertidas:</strong> ~200 horas en setup de infraestructura inicial
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="change-category">
                    <div class="category-title">
                        <span class="badge badge-feature">Seguridad</span>
                        <span>Protecci√≥n Multi-Capa</span>
                    </div>
                    <ul class="change-list">
                        <li class="change-item">
                            <div class="change-icon">üîí</div>
                            <div class="change-text">
                                <strong>Seguridad empresarial en todas las capas</strong>
                                <p class="change-description">
                                    ‚Ä¢ <strong>Autenticaci√≥n OTP:</strong> Login sin contrase√±a con c√≥digos de 6 d√≠gitos<br>
                                    ‚Ä¢ <strong>Row Level Security (RLS):</strong> Pol√≠ticas de PostgreSQL garantizan aislamiento de datos<br>
                                    ‚Ä¢ <strong>JWT tokens:</strong> Autenticaci√≥n stateless con Supabase Auth<br>
                                    ‚Ä¢ <strong>HTTPS everywhere:</strong> Todos los requests sobre TLS 1.3<br>
                                    ‚Ä¢ <strong>CORS configurado:</strong> Solo dominios autorizados<br>
                                    ‚Ä¢ <strong>Rate limiting:</strong> Protecci√≥n contra ataques de fuerza bruta<br>
                                    ‚Ä¢ <strong>SQL injection prevention:</strong> Prepared statements en todas las queries<br>
                                    ‚Ä¢ <strong>XSS protection:</strong> Sanitizaci√≥n de inputs y Content Security Policy<br>
                                    ‚Ä¢ <strong>Secrets management:</strong> Variables de entorno, nunca en c√≥digo<br><br>

                                    <strong>Horas invertidas:</strong> ~50 horas en configuraci√≥n de seguridad
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Documentado por el equipo de Autos TREFA</p>
            <p style="margin-top: 10px; font-size: 0.85em;">
                √öltima actualizaci√≥n: 25 de Octubre, 2025
            </p>
            <p style="margin-top: 5px; font-size: 0.85em; color: #999;">
                Periodo de desarrollo: Septiembre 18, 2024 - Octubre 25, 2025 (5 semanas)
            </p>
        </div>
    </div>
</body>
</html>
